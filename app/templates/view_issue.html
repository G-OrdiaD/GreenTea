{% extends "base.html" %}

{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
{% endblock %}

{% block content %}
<nav class="navbar">
    <div class="nav-title">Greenhouse Monitoring System</div>
    <div class="nav-buttons">
</nav>

<nav class="navbar">
    <div class="nav-title">Issue #{{ issue.id }}</div>
    <div class="nav-buttons">
        <a href="{{ url_for('main.dashboard') }}" class="nav-button">
            <i class="fas fa-arrow-left"></i> Dashboard
        </a>
        <a href="{{ url_for('auth.logout') }}" class="nav-button logout-btn">
            <i class="fas fa-sign-out-alt"></i> Logout
        </a>
    </div>
</nav>

<div class="table-container">
    <h3>Active Issues in {{ greenhouse.name }}</h3>
    <table class="greenhouse-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Issue</th>
                <th>Priority</th>
                <th>Assigned To</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for issue_item in greenhouse_issues %}
            <tr tabindex="0">
                <td>{{ issue_item.id }}</td>
               <td>Issue with {{ issue_item.parameter.name }} (Current Value: {{ issue_item.current_value }} {{ issue_item.parameter.unit }})</td>
                <td>
                    <span class="priority-{{ issue_item.priority|lower }}">
                        {{ issue_item.priority }}
                    </span>
                </td>
                <td>
                    {{ issue_item.assigned_to.username if issue_item.assigned_to else 'Unassigned' }}
                </td>
                <td>
                    <span class="status-{{ issue_item.status|lower }}">
                        {{ issue_item.status }}
                    </span>
                </td>
                <td class="action-links">
                    <a href="{{ url_for('main.view_issue', issue_id=issue_item.id) }}">View</a>
                    {% if current_user.is_admin %}
                    <a href="/issue/{{ issue_item.id }}/edit">Edit</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="status-update-form">
    <form action="{{ url_for('main.update_issue_status', issue_id=issue.id) }}" method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="form-group">
            <label for="status">Update Status:</label>
            <select name="status" id="status" class="form-select">
                <option value="Open" {% if issue.status =='Open' %}selected{% endif %}>Open</option>
                <option value="Fixing" {% if issue.status =='Fixing' %}selected{% endif %}>Fixing</option>
                <option value="Resolved" {% if issue.status =='Resolved' %}selected{% endif %}>Resolved</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i> Update Status
        </button>
    </form>
</div>
{% endblock %}