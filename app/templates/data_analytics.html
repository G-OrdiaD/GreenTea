{% extends "base.html" %}

{% block content %}
<nav class="navbar">
    <div class="nav-title">Greenhouse Monitoring System</div>
    <div class="nav-buttons">
        <a href="{{ url_for('main.dashboard') }}" class="nav-button">
            <i class="fas fa-arrow-left"></i> Dashboard
        </a>
        <a href="{{ url_for('auth.logout') }}" class="nav-button"
           style="background-color: #e74c3c; margin-left: 10px;">
            <i class="fas fa-sign-out-alt"></i> Logout
        </a>
    </div>
</nav>

<div class="analytics-container">
    <div class="subpage-header">
        <h2>Historical Data Analytics</h2>
    </div>

    <!-- Time Filters -->
    <div class="time-filters">
        <a href="{{ url_for('main.data_analytics', range='24h') }}"
           class="time-filter {{ 'active' if active_range == '24h' }}">24 Hours</a>
        <a href="{{ url_for('main.data_analytics', range='7d') }}"
           class="time-filter {{ 'active' if active_range == '7d' }}">7 Days</a>
        <a href="{{ url_for('main.data_analytics', range='30d') }}"
           class="time-filter {{ 'active' if active_range == '30d' }}">30 Days</a>
        <button class="time-filter" id="customRangeBtn">Custom Range</button>
    </div>

    <!-- Main Data Tables -->
    <div class="data-tables">
        {% for parameter, records in history_data.items() %}
        <div class="parameter-table">
            <h3>
                <i class="fas fa-{{
                    'temperature-high' if parameter == 'temperature'
                    else 'tint' if parameter == 'humidity'
                    else 'wind' if parameter == 'air_quality'
                    else 'vial' if parameter == 'ph_level'
                    else 'sun'
                }}"></i>
                {{ parameter.replace('_', ' ')|title }}
            </h3>

            <div class="table-responsive">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>Greenhouse</th>
                            <th>Value</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for record in records %}
                        <tr class="{{
                            'warning-row' if record.value > record.parameter.max_value
                            else 'danger-row' if record.value < record.parameter.min_value
                            else ''
                        }}">
                            <td>{{ record.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
                            <td>{{ record.greenhouse.name }}</td>
                            <td>{{ record.value }} {{ record.parameter.unit }}</td>
                            <td>
                                {% if record.value > record.parameter.max_value %}
                                    <i class="fas fa-arrow-up warning-icon"></i> High
                                {% elif record.value < record.parameter.min_value %}
                                    <i class="fas fa-arrow-down danger-icon"></i> Low
                                {% else %}
                                    <i class="fas fa-check-circle success-icon"></i> Normal
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}